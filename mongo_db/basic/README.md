# 몽고 DB 기초

## 도큐먼트

- 몽고 DB의 핵심으로 키와 연결된 값의 집합으로 이루어져있습니다.
- 관계형 데이터베이스의 행에 대응됩니다.
- 다양한 데이터 타입들을 지원합니다.
- 키에 `\0(null)문자`, `.`(점), `$` 문자를 사용할 수 없습니다. (`.`과 `$`는 특정 상황에만 사용해야 해서 예약어로 취급해야합니다.)
- 데이터형과 대소문자를 구분합니다.
    ```
    # 데이터형 구분
    {"age" : "3"}
    {"age" : 3}
    
    # 대소문자 구분
    {"name" : "John"}
    {"Name" : "John"}
    ```
- 한 도큐먼트 내에서 키가 중복될 수 없습니다.

<br>  
  
## 컬렉션

- 도큐먼트의 집합으로 이루어져있습니다.
- 관계형 데이터베이스의 테이블에 대응됩니다.
- 컬렉션명은 빈문자열, `\0(null)문자`, `system.`, 예약어인 `$`를 포함할 수 없습니다.
- 컬렉션은 동적 스키마를 가집니다.

### 동적 스키마

하나의 컬렉션 내 도큐먼트들이 서로 다른 구조를 가질 수 있습니다.

```
{"name" : "test", "age" : 3}
{"address" : "seoul", "phone" : "010-1234-5678"}
```

**여러개의 컬렉션을 사용하는 이유**

하나의 컬렉션에 모든 데이터를 저장하는 방식이 별도의 스키마 없이 가능할 수 있지만, 여러 개의 컬렉션을 사용하는 것이 여러 면에서 이점을 제공합니다.

1. 단일 컬렉션에서 데이터를 관리하는 것보다 여러 컬렉션을 사용하는 것이 데이터 관리를 더 용이하게 만듭니다.


2. 여러 컬렉션에 데이터를 분산시켜 저장하고 쿼리함으로써 쿼리 성능이 향상됩니다.


3. 같은 종류의 데이터를 하나의 컬렉션에 모으면 데이터 지역성이 개선되어 디스크 탐색 시간이 단축됩니다.


4. 유사한 유형의 문서를 한 컬렉션에 집중시키면 해당 컬렉션의 인덱싱이 더 효율적으로 이루어질 수 있습니다.

### 서브 컬렉션

`.`(마침표) 문자를 사용해 컬렉션을 체계화 할 수 있습니다.

exam.math, exam.english으로 데이터를 체계화하여 관리할 수 있습니다.

그러나 개발자가 컬렉션 간의 관계를 논리적으로 표현하기 위해 선택한 네이밍일 뿐 실제로 데이터베이스 내에서 이러한 구조를 강제하거나 유지하지 않습니다.

<br>

## 데이터베이스

- 컬렉션의 논리적인 그룹으로 이루어져있습니다.
- 단일 인스턴스는 여러 개의 독립적인 데이터베이스를 가질 수 있습니다.
- 데이터베이스명은 빈문자열, 특별한 문자(/, \, * 등등), `\0(null)문자`를 포함할 수 없고 대소문자를 구분합니다.
- 예약된 데이터베이스명을 사용하는 것을 피해야합니다. (admin, local, config)

<br>

## 데이터 형

MongoDB의 도큐먼트는 JSON 형식과 유사하지만, JSON에서 지원하지 않는 추가적인 데이터 타입을 제공합니다.
이에는 날짜, 정규 표현식, 배열, 내장 도큐먼트, 객체 ID, 이진 데이터(UTF-8이 아닌 문자열을 저장하는 유일한 방법), 그리고 코드가 포함됩니다.

### ObjectIds

여러 장비에 걸쳐 전역적으로 고유하게 생성하기 쉽게 설계 되었습니다.

자동으로 증가하는 기본 키를 사용하지 않는 이유는 분산 환경에서 동기화 작업이 어렵고 시간이 걸리는 문제를 해결하기 위함입니다.

몽고 DB는 분산 데이터로 설계되었기 때문에 샤딩된 환경에서 고유 식별자를 생성하는 것이 매우 중요했고 이를 해결하기 위해 ObjectId를 사용합니다.

<br>

## 실행

```shell
mongod
```

### 셸 실행

shell안에서 표준 자바스크립트 모든 기능을 활용할 수 있습니다.

```shell
# 이전 버전
mongo

# 최신 버전
mongosh
```

```shell
# 셸은 시작할 때 몽고DB 서버의 test 데이터베이스에 연결하고 연결을 전역변수 db에 할당합니다.
db # 현재 할당된 db 확인

use dev # 데이터베이스 변경

db.users # db 변수에서 컬렉션에 접근하여 users 컬렉션을 반환
```
