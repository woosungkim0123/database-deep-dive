# MongoDB 기초

## 개념

MongoDB는 강력하고 유연하며 확장성이 높은 문서(document, 도큐먼트) 지향 데이터베이스 입니다.

### 복잡한 구조를 단일 레코드로 표현

도큐먼트 모델은 내장 도큐먼트와 배열을 지원하여, 복잡한 계층적 관계를 단일 레코드로 표현할 수 있습니다. 

### 동적 스키마

스키마를 미리 정의하지 않음으로써 유연하고 다양한 종류의 데이터를 저장하고 관리할 수 있습니다.

그러나 데이터의 일관성, 검증, 그리고 애플리케이션의 로직에 따라 스키마를 강제하는 것이 필요할 수도 있습니다. 

MongoDB에서는 스키마 검증 기능을 제공합니다.

### 분산 확장

관계형 모델(테이블과 엄격한 스키마에 의존)을 사용하지 않으며 이는 주로 분산 시스템 환경에서의 확장성을 쉽게 하기 위함입니다.

NoSQL 데이터베이스는 데이터를 여러 서버에 걸쳐 분산시킬 수 있는 기능을 내장하고 있어, 데이터의 양이 증가함에 따라 쉽게 확장할 수 있습니다. (e.g. 샤딩)

**분산 확장**이 쉽다는 것은 대규모의 데이터를 효과적으로 관리하고, 데이터의 증가에 따라 시스템을 수월하게 확장할 수 있다는 것을 의미합니다.
이는 대용량 데이터 처리 및 고가용성이 중요한 현대의 애플리케이션 개발에 매우 중요한 특성입니다.

> 분산 확장  
> 
> - 데이터베이스의 데이터의 양이 증가함에 따라 추가적인 서버나 리소스를 통해 성능과 저장 용량을 확장할 수 있는 능력을 의미합니다.  
> - MongoDB와 같은 NoSQL 데이터베이스는 분산 확장성을 염두에 두고 설계되었습니다.
> - 관계형 데이터베이스는 트랜잭션의 ACID 속성(원자성, 일관성, 고립성, 지속성)을 유지하면서 데이터를 안전하게 저장하고 관리하는 데 초점을 맞춥니다. 
> 이로 인해 데이터를 여러 서버에 분산하여 확장하는 것을 복잡하게 만들 수 있습니다.

> 고가용성
>
> 시스템이 장애가 발생하더라도 중단 없이 지속적으로 운영될 수 있는 능력을 말합니다.

**스케일 업과 스케일 아웃**

서비스가 커지면서 저장하는 데이터량이 증가하였고 데이터베이스 확장 문제에 부딪치게 되었습니다.

더 좋은 장비를 사용하여 확장(Scale up)할지 여러 장비에 나눠 분산할지(Scale Out) 결정해야 합니다.

대형 장비는 비싸고 결국 나중에는 확장할 수 없는 물리적 한계에 부딪힐 수 있습니다.

분산 확장은 저장 공간이나 처리 능력을 증가시키기 위해 추가적인 서버를 구매하고 이를 기존 시스템에 통합하여 클러스터를 형성하는 방법입니다.

이 방법은 경제적이고 확장에 용이하지만 관리가 복잡해집니다.

> 클러스터(Cluster)
> 
> 여러 대의 컴퓨터(서버)가 마치 하나의 시스템처럼 연결되어 함께 작동하는 것을 말합니다.

> 클러스터 토폴리지(Cluster Topology)
> 
> 클러스터 내의 컴퓨터(또는 노드)들이 어떻게 연결되고 상호 작용하는지를 설명하는 구조나 형태를 말합니다

### MongoDB가 부적합 한 경우

다양한 유형의 데이터를 여러 차원에 걸쳐 조인하는 작업이 많은 경우에는 관계형 데이터베이스가 더 적합할 수 있습니다.

관계형 데이터베이스는 지원하지만 MongoDB는 지원하지 않는 도구를 사용하는 경우에는 관계형 데이터베이스가 더 적합할 수 있습니다.

<br>

## 도큐먼트

- 몽고 DB의 핵심으로 키와 연결된 값의 집합으로 이루어져있습니다.
- 관계형 데이터베이스의 행에 대응됩니다.
- 다양한 데이터 타입들을 지원합니다.
- 키에 `\0(null)문자`, `.`(점), `$` 문자를 사용할 수 없습니다. (`.`과 `$`는 특정 상황에만 사용해야 해서 예약어로 취급해야합니다.)
- 데이터형과 대소문자를 구분합니다.
    ```
    # 데이터형 구분
    {"age" : "3"}
    {"age" : 3}
    
    # 대소문자 구분
    {"name" : "John"}
    {"Name" : "John"}
    ```
- 한 도큐먼트 내에서 키가 중복될 수 없습니다.

<br>  
  
## 컬렉션

- 도큐먼트의 집합으로 이루어져있습니다.
- 관계형 데이터베이스의 테이블에 대응됩니다.
- 컬렉션명은 빈문자열, `\0(null)문자`, `system.`, 예약어인 `$`를 포함할 수 없습니다.
- 컬렉션은 동적 스키마를 가집니다.

### 동적 스키마

하나의 컬렉션 내 도큐먼트들이 서로 다른 구조를 가질 수 있습니다.

```
{"name" : "test", "age" : 3}
{"address" : "seoul", "phone" : "010-1234-5678"}
```

**여러개의 컬렉션을 사용하는 이유**

하나의 컬렉션에 모든 데이터를 저장하는 방식이 별도의 스키마 없이 가능할 수 있지만, 여러 개의 컬렉션을 사용하는 것이 여러 면에서 이점을 제공합니다.

1. 단일 컬렉션에서 데이터를 관리하는 것보다 여러 컬렉션을 사용하는 것이 데이터 관리를 더 용이하게 만듭니다.


2. 여러 컬렉션에 데이터를 분산시켜 저장하고 쿼리함으로써 쿼리 성능이 향상됩니다.


3. 같은 종류의 데이터를 하나의 컬렉션에 모으면 데이터 지역성이 개선되어 디스크 탐색 시간이 단축됩니다.


4. 유사한 유형의 문서를 한 컬렉션에 집중시키면 해당 컬렉션의 인덱싱이 더 효율적으로 이루어질 수 있습니다.

### 서브 컬렉션

`.`(마침표) 문자를 사용해 컬렉션을 체계화 할 수 있습니다.

exam.math, exam.english으로 데이터를 체계화하여 관리할 수 있습니다.

그러나 개발자가 컬렉션 간의 관계를 논리적으로 표현하기 위해 선택한 네이밍일 뿐 실제로 데이터베이스 내에서 이러한 구조를 강제하거나 유지하지 않습니다.

<br>

## 데이터베이스

- 컬렉션의 논리적인 그룹으로 이루어져있습니다.
- 단일 인스턴스는 여러 개의 독립적인 데이터베이스를 가질 수 있습니다.
- 데이터베이스명은 빈문자열, 특별한 문자(/, \, * 등등), `\0(null)문자`를 포함할 수 없고 대소문자를 구분합니다.
- 예약된 데이터베이스명을 사용하는 것을 피해야합니다. (admin, local, config)

<br>

## 데이터 형

MongoDB의 도큐먼트는 JSON 형식과 유사하지만, JSON에서 지원하지 않는 추가적인 데이터 타입을 제공합니다.
이에는 날짜, 정규 표현식, 배열, 내장 도큐먼트, 객체 ID, 이진 데이터(UTF-8이 아닌 문자열을 저장하는 유일한 방법), 그리고 코드가 포함됩니다.

### ObjectIds

여러 장비에 걸쳐 전역적으로 고유하게 생성하기 쉽게 설계 되었습니다.

자동으로 증가하는 기본 키를 사용하지 않는 이유는 분산 환경에서 동기화 작업이 어렵고 시간이 걸리는 문제를 해결하기 위함입니다.

몽고 DB는 분산 데이터로 설계되었기 때문에 샤딩된 환경에서 고유 식별자를 생성하는 것이 매우 중요했고 이를 해결하기 위해 ObjectId를 사용합니다.

<br>

## 실행

```shell
mongod
```

### 셸 실행

셸 안에서 표준 자바스크립트 모든 기능을 활용할 수 있습니다.

```shell
# 이전 버전
mongo

# 최신 버전
mongosh
```

```shell
# 셸은 시작할 때 몽고DB 서버의 test 데이터베이스에 연결하고 연결을 전역변수 db에 할당합니다.
db # 현재 할당된 db 확인

use dev # 데이터베이스 변경

db.users # db 변수에서 컬렉션에 접근하여 users 컬렉션을 반환
```
